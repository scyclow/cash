
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cold Hard Cash</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’µ</text></svg>">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Each Cold Hard Cash (CASH) token holder may request that the currency depicted in their token's thumbnail be mailed to them. All shipment costs above the cost of standard domestic postage shall be made at the expense of the token holder. The Artist shall not be held liable for any shipments lost in the mail. The Artist shall make a good faith effort to store all physical currency until such mailing takes place, but makes no guarantee on their ability to carry out said shipment. Please contact the Artist directly to arrange a shipment.">
  <meta name="keywords" content="cold hard cash, cold, hard, cash, auction, nft, photography, conceptual photography, conceptual art, art, steviep, steve pikelny, pikelny, crypto, ethereum, bitcoin">

  <meta name="twitter:image" content="https://steviep.xyz/cash/assets/11.jpg">
  <meta name="twitter:image:alt" content="Cold Hard Cash">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@steviepxyz">
  <meta name="twitter:site" content="@steviepxyz">
  <meta property="twitter:description" content="Each Cold Hard Cash (CASH) token holder may request that the currency depicted in their token's thumbnail be mailed to them. All shipment costs above the cost of standard domestic postage shall be made at the expense of the token holder. The Artist shall not be held liable for any shipments lost in the mail. The Artist shall make a good faith effort to store all physical currency until such mailing takes place, but makes no guarantee on their ability to carry out said shipment. Please contact the Artist directly to arrange a shipment.">

  <meta name="og:image" property="og:image" content="https://steviep.xyz/cash/assets/11.jpg">
  <meta name="og:image:alt" content="Cold Hard Cash">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://steviep.xyz/cash">
  <meta property="og:title" content="Cold Hard Cash">
  <meta property="og:site_name" content="Cold Hard Cash">
  <meta property="og:description" content="Each Cold Hard Cash (CASH) token holder may request that the currency depicted in their token's thumbnail be mailed to them. All shipment costs above the cost of standard domestic postage shall be made at the expense of the token holder. The Artist shall not be held liable for any shipments lost in the mail. The Artist shall make a good faith effort to store all physical currency until such mailing takes place, but makes no guarantee on their ability to carry out said shipment. Please contact the Artist directly to arrange a shipment.">

  <link rel="stylesheet" type="text/css" href="./styles.css">


  <style type="text/css">
    * {
      font-family: sans-serif;
    }

    header {
      display: flex;
      justify-content: flex-end;
      padding: 0.25em;
      margin-bottom: 1em;
      max-width: 1500px;
      margin: auto;
    }


    .aboveFold, .lastUpdatedSection, footer {
      max-width: 600px;
      margin: auto;
      padding: 0 1em;
    }

    .lastUpdatedSection {
      margin-top: 2em;
      margin-bottom: 2em;
    }

    footer {
      padding-top: 1em;
      padding-bottom: 1em;
      text-align: center;
    }

    h1 {
      text-align: center;
      margin: 0.5em 0;
      font-size: 4em;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 3em;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.9em;
      }
    }

    .address {
      font-family: monospace;
    }

    #connectWalletSection {
      display: flex;
      justify-content: center;
    }

    #connectedAs {
      font-size: 1.25em;
    }
    #lastUpdated, #connectedAs, #connectedBalance, #connectedNetwork {
      font-family: monospace;
    }

    .connectionSection {
      padding: 0.5em;
    }

    .connectButton {
      font-size: 1em;
      padding: 0.5em 1em;
      cursor: pointer;
    }

    #connectedAs {
      text-overflow: ellipsis;
      overflow: hidden;
      max-width: 100%;
    }


    button {
      cursor: pointer;
      background: #000;
      color: #fff;
      border: 1px solid;
      transition: 150ms;
    }

    button:hover {
      background: #fff;
      color: #000;
    }




    .label {
      text-transform: uppercase;
      font-size: 0.75em;
      font-weight: bold;
    }

    #connectedAs {
      text-transform: none;
    }


    @media (max-width: 370px) {
      .address {
        font-size: 0.85em;
      }
    }


    .grid {
      margin: auto;
      padding: 1em;
      max-width: 1500px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      column-gap: 1vw;
      row-gap: 0.6vw;
    }

    .grid img {
      width: 100%;
    }

    @media (max-width: 1100px) {
      .grid {
        grid-template-columns: 1fr 1fr;
        max-width: 1000px;
      }
      .grid > * {
        grid-column-start: initial !important;
      }
    }


    @media (max-width: 500px) {
      .grid {
        grid-template-columns: 1fr;
      }
      .grid > *:last-child {
        grid-column-start: initial !important;
      }
    }

    img {
      border: 1px solid;
    }

    .infoCard {
      background: #fff;
      display: inline-block;
      transform: translate(1px, calc(-100% - 5px));
      padding: 0.5em;
      opacity: 0.7;
    }

    .infoCard {
      color: #000;
    }

    .nightmode .infoCard {
      background: #000;
    }
    .nightmode .infoCard {
      color: #fff;
    }

    .auctionPanel {
      transition: 125ms;
    }

    .auctionPanel:hover {
      filter: sepia(0.3);
    }

    .auctionPanel:hover .infoCard {
      background: #000;
      color: #fff;
    }

    .auctionPanel.endingSoon img {
      border: 2px solid #c40000;
    }

    .nightmode .auctionPanel:hover .infoCard {
      background: #fff;
    }
    .nightmode .auctionPanel:hover .infoCard * {
      color: #000;
    }



    .auctionInfo {
      font-family: monospace;
      font-size: 0.9em;
    }




    .auctionPanel img {
      border-color: #000;
    }

    .nightmode .auctionPanel img {
      border-color: #fff;
    }

    p {
      margin-bottom: 0.5em;
      text-align: justify;
    }

    code {
      font-family: monospace;
      text-align: center;
      display: block;
      margin-bottom: 0.5em;
    }

    aside {
      font-size: 10px;
      display: block;
      margin: 0.8em auto;
      max-width: 450px;
    }

    .calculation code {
      text-align: left;
      margin-left: 1em;
    }

    .calculation {
      margin: auto;
      max-width: 480px;
    }




ul#previousBidList {
  list-style-type: none;
  padding: 0;
  margin: 0;
}


.bidHistoryItem {
  margin: 1em 0;
  border-bottom: 1px dashed;
  padding-bottom: 0.5em;
}
.bidHistoryItem * {
  font-family: monospace;
}


.bidHistoryRow {
  display: flex;
  justify-content: space-between;
}

  </style>
</head>

<body>
  <header>
    <connect-wallet id="wallet-connect" class="connectionSection">
      <section slot="notConnected">
        <connect-button>
          <button slot="button" class="connectButton">Connect Wallet</button>
          <div slot="loading">Loading...</div>
          <div slot="error" class="error"></div>
        </connect-button>
      </section>


      <section slot="connected">
        <section>
          <h3 class="label">CONNECTED AS: <span id="connectedAs"></span></h3>
          <div id="connectedBalance"></div>
          <div id="connectedNetwork"></div>
        </section>
      </section>
    </connect-wallet>
  </header>

  <main>
    <div class="aboveFold">
      <h1>COLD HARD CASH</h1>
      <p>Each Cold Hard Cash (CASH) token holder may request that the currency depicted in their token's thumbnail be mailed to them. All shipment costs above the cost of standard domestic postage shall be made at the expense of the token holder. The Artist shall not be held liable for any shipments lost in the mail. The Artist shall make a good faith effort to store all physical currency until such mailing takes place, but makes no guarantee on their ability to carry out said shipment. Please contact the Artist directly to arrange a shipment.</p>
      <p>The reserve price of each auction is based on the following calculation:</p>
      <code>$G/16 + (USDETH * ($U + $L/16))</code>

      <p>Where</p>
      <div class="calculation">
        <code>USDETH = 0.00064 (USD/ETH exchange rate as of 10/18/2023)</code>
        <code>$G = 0.314 (Total gas expense of deploying CASH contract + auction initialization)</code>
        <code>$U = The nominal USD value depicted in the NFT thumbnail</code>
        <code>$L = 18.56 hours of labor * $15.00 (NYC minimum wage)<aside>NOTE: $L is not inclusive of labor undertaken while conceptualizing or planning for the CASH project. In addition, this does not take into account labor directed towards the creation of reusable web and smart contract-based components undertaken prior to the development of the CASH project</aside></code>
      </div>

      <div style="display: flex; justify-content: center;">
        <h3 style="display: inline-block; padding: 0.5em;"><a href="https://etherscan.io/address/0x6dea3f6f1bf5ce6606054baabf5452726fe4dea1#code" target="_blank" rel="nofollow" id="etherscanLink">Etherscan</a></h3>
        <!-- <h3 style="display: inline-block; padding: 0.5em;"><a href="#" target="_blank" rel="nofollow">OpenSea</a></h3> -->
      </div>
    </div>



    <connect-wallet id="wallet-connect">
      <section slot="connected">
        <div class="center" style="margin:1.5em 0;">
          <label style="cursor: pointer;">
            <input type="checkbox" id="wantsNotifications" style="cursor: pointer;">
            receive notifications on all new bids [beta]
          </label>
        </div>
      </section>
    </connect-wallet>

    <section id="grid" class="grid"></section>



    <connect-wallet id="wallet-connect">
      <section slot="connected" class="center" style="text-align: left;">
        <section id="bidHistory" class="bidSection">
          <h2 style="text-align: center; margin-top: 1em;">All Bids</h2>
          <ul id="previousBidList"></ul>
        </section>
      </section>
    </connect-wallet>

    <connect-wallet id="wallet-connect">
      <section slot="connected" class="center" style="text-align: left;">



        <section class="bidSection lastUpdatedSection">
          <h3 class="label">DATA LAST UPDATED:</h3>
          <div id="lastUpdated"></div>
        </section>
      </section>
    </connect-wallet>


  </main>

  <footer><a href="https://steviep.xyz" target="_blank">steviep.xyz</a> (c) 2023</footer>
</body>

<script src="./$.js"></script>
<script src="./webComponents.js"></script>
<script src="./web3Components.js"></script>
<script src="./connectWallet.js"></script>
<script src="./min.ethers.js"></script>

<script type="text/javascript">


  const auctions = [
    { title: '$0.00', auctionId: 16 + 0, url: './auctions/0', img: './assets/0.jpg' },
    { title: '$0.01', auctionId: 16 + 1, url: './auctions/1', img: './assets/1.jpg' },
    { title: '$0.05', auctionId: 16 + 2, url: './auctions/2', img: './assets/2.jpg' },
    { title: '$0.10', auctionId: 16 + 3, url: './auctions/3', img: './assets/3.jpg' },
    { title: '$0.25', auctionId: 16 + 4, url: './auctions/4', img: './assets/4.jpg' },
    { title: '$0.50', auctionId: 16 + 5, url: './auctions/5', img: './assets/5.jpg' },
    { title: '$1.00', auctionId: 16 + 6, url: './auctions/6', img: './assets/6.jpg' },
    { title: '$2.00', auctionId: 16 + 7, url: './auctions/7', img: './assets/7.jpg' },
    { title: '$5.00', auctionId: 16 + 8, url: './auctions/8', img: './assets/8.jpg' },
    { title: '$6.67', auctionId: 16 + 9, url: './auctions/9', img: './assets/9.jpg' },
    { title: '$10.00', auctionId: 16 + 10, url: './auctions/10', img: './assets/10.jpg' },
    { title: '$20.00', auctionId: 16 + 11, url: './auctions/11', img: './assets/11.jpg' },
    { title: '$50.00', auctionId: 16 + 12, url: './auctions/12', img: './assets/12.jpg' },
    { title: '$50.32', auctionId: 16 + 13, url: './auctions/13', img: './assets/13.jpg' },
    { title: '$100.00', auctionId: 16 + 14, url: './auctions/14', img: './assets/14.jpg' },
    { title: '$???.??', auctionId: 16 + 15, url: './auctions/15', img: './assets/15.jpg' },
  ]


  const auctionMap = {
    [16 + 0]: '$0.00',
    [16 + 1]: '$0.01',
    [16 + 2]: '$0.05',
    [16 + 3]: '$0.10',
    [16 + 4]: '$0.25',
    [16 + 5]: '$0.50',
    [16 + 6]: '$1.00',
    [16 + 7]: '$2.00',
    [16 + 8]: '$5.00',
    [16 + 9]: '$6.67',
    [16 + 10]: '$10.00',
    [16 + 11]: '$20.00',
    [16 + 12]: '$50.00',
    [16 + 13]: '$50.32',
    [16 + 14]: '$100.00',
    [16 + 15]: '$???.??',
  }



















  const provider = new Web3Provider()
  mountComponents(
    ConnectWallet(provider, 'connectWallet'),
    ConnectButton(provider),
  )

  const network = 'mainnet'
  const etherscanPrefix = network === 'goerli' ? 'goerli.' : ''


  const STEVIEP_AUCTION = {
    // local: '0x46d4674578a2daBbD0CEAB0500c6c7867999db34'
    local: '0x5FbDB2315678afecb367f032d93F642f64180aa3',
    goerli: '0x39665bCA42F60413b2E162a24a2FE1B290F5a2f9',
    mainnet: '0xd577B12732DA7557Db7eeA82e53d605f42C618d8',
  }[network]

  const UNISWAP_V2 = {
    // local: '0xC220Ed128102d888af857d137a54b9B7573A41b2',
    local: '0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9',
    goerli: '0xB3ca1a2F6dAD720B5D89cc2cf2B0160aB357f13E',
    mainnet: '0xb4e16d0168e52d35cacd2c6185b44281ec28c9dc'
  }[network]

  const COLD_HARD_CASH = {
    local: '0x4A679253410272dd5232B3Ff7cF5dbB88f295319',
    goerli: '0x1993C771E5bE2bac9Eea3297EA850c5Da3cf732F',
    mainnet: '0x6DEa3f6f1bf5ce6606054BaabF5452726Fe4dEA1'
  }[network]


  const auctionStruct = `(
    bool tokenExists,
    uint256 duration,
    uint256 bidIncreaseBps,
    uint256 bidTimeExtension,
    uint256 minBid,
    uint256 tokenId,
    uint256 startTime,
    address beneficiary,
    bool approveFutureTransfer,
    address minterContract,
    address rewardContract,
    address allowListContract
  )`

  const bidStruct = `(uint128 amount, uint128 timestamp, address bidder)`

  const auctionABI = [
    'event BidMade(uint256 indexed auctionId, address indexed bidder, uint256 amount, uint256 timestamp)',
    'function auctionCount() external view returns (uint256)',
    `function auctionIdToHighestBid(uint256) external view returns (${bidStruct})`,
    'function auctionEndTime(uint256) external view returns (uint256 endTime)',
    `function auctionIdToAuction(uint256) external view returns (${auctionStruct})`,
    'function isActive(uint256 auctionId) external view returns (bool)',
    'function bid(uint256 auctionId) external payable',
    'function settle(uint256 auctionId) external payable',
  ]

  const uniswapV2ABI = [
    'function getReserves() external view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast)'
  ]

  const rawSteviepAuction = provider.rawContract(STEVIEP_AUCTION, auctionABI)










  const $grid = $.id('grid')
  const $lastUpdated = $.id('lastUpdated')
  const $connectedAs = $.id('connectedAs')
  const $connectedBalance = $.id('connectedBalance')
  const $connectedNetwork = $.id('connectedNetwork')
  const $etherscanLink = $.id('etherscanLink')
  const $wantsNotifications = $.id('wantsNotifications')
  const $bidHistory = $.id('bidHistory')
  const $previousBidList = $.id('previousBidList')

  $etherscanLink.href = `https://${etherscanPrefix}etherscan.io/address/${COLD_HARD_CASH}`




  $grid.innerHTML = auctions
  .map(a => `
    <div class="auctionPanel" id="auctionPanel-${a.auctionId}">
      <a href="${a.url}">
        <img src="${a.img}">
        <div style="height: 0">
          <div class="infoCard">
            <h3>${a.title}</h3>
            <h3 class="auctionInfo" id="timeLeft-${a.auctionId}"></h3>
            <h3 class="auctionInfo" id="highestBid-${a.auctionId}"></h3>
            <h3 class="auctionInfo" id="highestBidder-${a.auctionId}"></h3>
          </div>
        </div>
      </a>
    </div>
  `).join('')


  let notificationPermission

  if ($wantsNotifications) $wantsNotifications.onclick = () => {
    if ($wantsNotifications.checked) {
      notificationPermission = Notification.requestPermission()
    } else {
      notificationPermission = false
    }
  }



  const activeCountdownIntervals = {}
  const recentBidMap = {}

  async function updateBidInfo(signer, steviepAuction, uniswapV2) {
    const signerAddr = await signer.getAddress()

    const [
      connectedNetwork,
      connectedBalance,
      formattedAddr
    ] = await Promise.all([
      provider.getNetwork(),
      provider.getETHBalance(signerAddr),
      formatAddr(signerAddr, provider),
    ])

    let networkName, networkDescriptor
    if (connectedNetwork.name && connectedNetwork.name !== 'unknown') {
      networkName = connectedNetwork.chainId === 1 ? 'mainnet' : connectedNetwork.name
      networkDescriptor = 'Network'
    } else {
      networkName = connectedNetwork.chainId
      networkDescriptor = 'Network ID'
    }

    $connectedNetwork.innerHTML = `${networkDescriptor}: ${networkName}`

    $connectedAs.innerHTML = `<a href="https://${etherscanPrefix}etherscan.io/address/${signerAddr}" target="_blank" class="address">${
      isENS(formattedAddr) ? formattedAddr : await formatAddr(signerAddr, provider)
    }</a>`
    $connectedBalance.innerHTML = `Balance: ${ethVal(connectedBalance)} ETH`


    const [
      blockNumber,
      ethUsd
    ] = await Promise.all([
      provider.provider.getBlockNumber(),
      getEthUsd(uniswapV2)

    ]).catch(e => console.log(e))

    const block = await provider.provider.getBlock(blockNumber)
    const timeDiff = Date.now() - block.timestamp*1000

    const timeLeftList = []

    for (let a of auctions) {
      const [
        highestBid,
        auction,
        auctionEndTime,
        isActive,
      ] = await Promise.all([
        steviepAuction.auctionIdToHighestBid(a.auctionId),
        steviepAuction.auctionIdToAuction(a.auctionId),
        steviepAuction.auctionEndTime(a.auctionId),
        steviepAuction.isActive(a.auctionId),
      ])

      const reservePrice = ethVal(auction.minBid)
      const hasBid = !!bnToN(highestBid.timestamp)

      const bidAmount = ethVal(highestBid.amount)
      const timeLeft = Math.max(bnToN(auctionEndTime)*1000 - Date.now(), 0)

      const endingSoon = timeLeft < auction.bidTimeExtension*1000 && timeLeft > 0 && isActive

      timeLeftList.push({timeLeft, endingSoon, isActive, auctionId: a.auctionId})

      const $highestBid = $.id(`highestBid-${a.auctionId}`)
      const $timeLeft = $.id(`timeLeft-${a.auctionId}`)
      const $highestBidder = $.id(`highestBidder-${a.auctionId}`)

      if (!bidAmount) {
        $highestBid.innerHTML = `Reserve: ${reservePrice} ETH (~$${(reservePrice * ethUsd).toFixed(2)})`
      } else if (isActive) {
        $highestBid.innerHTML = `Highest Bid: ${bidAmount} ETH (~$${(bidAmount * ethUsd).toFixed(2)})` + (endingSoon ? ' [ENDING SOON]' : '')
        if (activeCountdownIntervals[a.auctionId]) activeCountdownIntervals[a.auctionId]()

        $highestBidder.innerHTML = `<a href="https://${etherscanPrefix}etherscan.io/address/${highestBid.bidder}" target="_blank" class="address">${await formatAddr(highestBid.bidder, provider)}</a>`

      // `Reserve: ${reservePrice} ETH (~$${(reservePrice * ethUsd).toFixed(2)})`

        activeCountdownIntervals[a.auctionId] = triggerTimer(timeLeft, $timeLeft)


        if (!recentBidMap[a.auctionId]) {
          recentBidMap[a.auctionId] = bidAmount
        } else if (notificationPermission && (bidAmount !== recentBidMap[a.auctionId])) {
          recentBidMap[a.auctionId] = bidAmount

          notificationPermission.then(p => {
            const notification = new Notification(`ðŸ’µ New Cold Hard Cash Bid ðŸ’µ`, {
              body: `${a.title} â†’ ${bidAmount} ETH`,
              icon: a.img,
              requireInteraction: true
            })
          })
        } else if (bidAmount !== recentBidMap[a.auctionId]) {
          recentBidMap[a.auctionId] = bidAmount
        }

      } else {
        $highestBid.innerHTML = `Sold for: ${bidAmount} ETH (~$${(bidAmount * ethUsd).toFixed(2)})`
      }
    }

    const auctionsBidOn = ls.get('__AUCTIONS_BID_ON__') || {}

    timeLeftList
      .sort((a, b) => {
        if (b.endingSoon && !a.endingSoon) return 1
        if (a.endingSoon && !b.endingSoon) return -1
        // if (a.isActive && !b.isActive) return -1
        // if (b.isActive && !a.isActive) return 1
        // if (!a.isActive && !b.isActive) return 0
        // if (!a.isActive && auctionsBidOn[b.auctionId]) return 1
        // if (!b.isActive && auctionsBidOn[a.auctionId]) return -1
        // if (a.timeLeft && !b.timeLeft) return -1
        // if (!a.timeLeft && b.timeLeft) return 1
        // if (a.timeLeft && b.timeLeft) {
        //   return a.timeLeft - b.timeLeft
        // }
        return 0
      })
      .forEach((auction, i) => {
        const panel = $.id(`auctionPanel-${auction.auctionId}`)
        $(panel, 'order', i)
        if (i === timeLeftList.length-1) {
          $(panel, 'grid-column-start', '2')
        }

        if (auction.endingSoon) panel.classList.add('endingSoon')
      })


    $lastUpdated.innerHTML = `Local timestamp: ${new Date()} <br>Block timestamp: ${new Date(block.timestamp*1000)}<br>[Block: ${blockNumber}]<br><strong><a href="https://${etherscanPrefix}etherscan.io/address/${STEVIEP_AUCTION}" target="_blank" rel="nofollow" style="font-family:monospace">AUCTION CONTRACT</a></strong>`




    try {
      const bidFilter = steviepAuction.filters.BidMade()

      const unsortedBidsMade = await steviepAuction.queryFilter(bidFilter).then(rawBids =>
        Promise.all(
          rawBids.map(
            async e => ({
              bidder: e.args.bidder,
              bidderDisplay: await formatAddr(e.args.bidder, provider),
              amount: ethVal(e.args.amount),
              auctionId: bnToN(e.args.auctionId),
              timestamp: bnToN(e.args.timestamp),
            })
          )
        )
      )

      const bidsMade = unsortedBidsMade.sort((a,b) => b.timestamp - a.timestamp)

      if (bidsMade.length) {
        $previousBidList.innerHTML = bidsMade
        .filter(bid => bid.auctionId >= 16 && bid.auctionId < 32)
        .map(bid => {
          const bidAmount = Number(bid.amount.toFixed(14))
          const bidAmountUSD = (bidAmount * ethUsd).toFixed(2)
          const bidAmountPretty = String(bidAmount).includes('.') ? bidAmount : bidAmount.toFixed(1)
          return `
            <li class="bidHistoryItem">
              <div class="bidHistoryRow">
                <strong>${auctionMap[bid.auctionId]}</strong>
                <div>${bidAmountPretty} ETH (~$${bidAmountUSD})</div>
                <div>
                  <a href="https://${etherscanPrefix}etherscan.io/address/${bid.bidder}" target="_blank" class="address">${bid.bidderDisplay}</a>
                </div>
              </div>
              <div>${new Date(bid.timestamp * 1000)}</div>
            </li>
          `
        }).join('')
      }
    } catch (e) {
      console.error(e)
    }
  }

  provider.onConnect(async () => {
    const steviepAuction = await provider.contract(STEVIEP_AUCTION, auctionABI)
    const uniswapV2 = await provider.contract(UNISWAP_V2, uniswapV2ABI)
    const rawSteviepAuction = provider.rawContract(STEVIEP_AUCTION, auctionABI)

    setRunInterval(() => updateBidInfo(provider.signer, steviepAuction, uniswapV2), 3000)

  })




  async function getEthUsd(uniswapV2) {
    const decimals = 2
    const { _reserve0, _reserve1 } = await uniswapV2.getReserves()
    return _reserve0.mul(1000000000000).mul(10**decimals).div(_reserve1).toNumber() / 10**decimals
  }




  function formatMinBid(amt) {
    return Math.ceil(amt * 1000) / 1000
  }

  function isENS(ens) {
    return ens.slice(-4) === '.eth'
  }
  async function formatAddr(addr, provider, truncate=true) {
    try {
      const ens = await provider.getENS(addr)
      if (ens.slice(-4) === '.eth') {
        return ens.length > 19
          ? ens.slice(0, 16) + '...'
          : ens
      } else {
        return truncate ? truncateAddr(addr) : addr
      }
    } catch (e) {
      return truncate ? truncateAddr(addr) : addr
    }
  }


  function unhide(element) {
    $(element, 'display', '')
  }

  function hide(element) {
    $(element, 'display', 'none')
  }

  function setRunInterval(fn, ms, i=0) {
    const run = () => {
      fn(i)
      i++
    }

    run()

    let isCleared = false

    let interval = setInterval(run, ms)

    const newInterval = (ms) => {
      if (isCleared) return
      clearInterval(interval)
      interval = setInterval(run, ms)
    }

    const stopInterval = () => {
      if (!isCleared) {
        clearInterval(interval)
        isCleared = true
      }
    }
    return stopInterval
  }

  function triggerTimer(timeLeft, $elem) {
    const with0 = x => x < 10 ? '0' + Math.floor(x) : Math.floor(x)
    let timeLeftCounter = timeLeft
    return setRunInterval(() => {
      timeLeftCounter = Math.max(timeLeftCounter - 1000, 0)
      const days = timeLeftCounter / (24*60*60*1000)
      const hours = 24 * (days%1)
      const minutes = 60 * (hours%1)
      const seconds = Math.floor(60 * (minutes%1))
      const ms = Math.floor(timeLeftCounter % 1000 / 100) % 10

      $elem.innerHTML = `${Math.floor(days)}:${with0(hours)}:${with0(minutes)}:${with0(seconds)}`
    }, 1000)
  }

</script>



<script type="text/javascript">
  var hours = new Date().getHours();
  if (hours <= 5 || hours >= 21)
    document.body.className = 'nightmode';
</script>
</html>